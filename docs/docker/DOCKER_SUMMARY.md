# Docker ç¿»è¯‘æµ‹è¯•ç¯å¢ƒ - å®Œæˆæ€»ç»“

## âœ… å·²åˆ›å»ºçš„æ–‡ä»¶

### 1. Docker ç›¸å…³

- **`Dockerfile.translate`** - Docker é•œåƒå®šä¹‰
  - åŸºäº Ubuntu 22.04
  - åŒ…å« Rustã€Clangã€LLVMã€bear
  - è‡ªåŠ¨é…ç½®ç¯å¢ƒå˜é‡

### 2. è„šæœ¬æ–‡ä»¶

- **`scripts/docker_run.ps1`** - Windows PowerShell å¯åŠ¨è„šæœ¬
  - ä¸€é”®æ„å»ºå’Œè¿è¡Œå®¹å™¨
  - è‡ªåŠ¨æŒ‚è½½é¡¹ç›®ç›®å½•
  - æ¸…ç†é€‰é¡¹

- **`scripts/docker_run.sh`** - Linux/Mac Bash å¯åŠ¨è„šæœ¬
  - ä¸ PowerShell ç‰ˆæœ¬åŠŸèƒ½ç›¸åŒ
  - è·¨å¹³å°å…¼å®¹

- **`scripts/test_translation.sh`** - å®¹å™¨å†…è‡ªåŠ¨æµ‹è¯•è„šæœ¬
  - æ£€æŸ¥ç¯å¢ƒ
  - ç”Ÿæˆ compile_commands.json
  - è¿è¡Œ AST åˆ° MIR è½¬æ¢
  - æµ‹è¯• LLM è¿æ¥
  - ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

- **`scripts/translate_single_file.sh`** - å•æ–‡ä»¶ç¿»è¯‘è„šæœ¬
  - åˆ©ç”¨ 1049K ä¸Šä¸‹æ–‡
  - åŒ…å«å¤´æ–‡ä»¶ä¸Šä¸‹æ–‡
  - è‡ªåŠ¨ç¼–è¯‘éªŒè¯
  - unsafe å æ¯”åˆ†æ

### 3. æ–‡æ¡£

- **`DOCKER_GUIDE.md`** - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
  - è¯¦ç»†æ­¥éª¤è¯´æ˜
  - å¸¸è§é—®é¢˜è§£ç­”
  - æ€§èƒ½å’Œæˆæœ¬ä¼°ç®—
  - é«˜çº§ç”¨æ³•

- **`DOCKER_QUICKREF.md`** - å¿«é€Ÿå‚è€ƒå¡ç‰‡
  - å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
  - æ•…éšœæ’é™¤
  - æ¨èæµç¨‹

- **`README.md`** - å·²æ›´æ–°ï¼Œæ·»åŠ  Docker éƒ¨åˆ†

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¯åŠ¨ï¼ˆ3 æ­¥ï¼‰

```powershell
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd C:\Users\baoba\Desktop\C2RustAgent

# 2. å¯åŠ¨ Docker
.\scripts\docker_run.ps1

# 3. åœ¨å®¹å™¨å†…é…ç½® API Keyï¼ˆå¦‚éœ€ä½¿ç”¨ LLMï¼‰
nano /workspace/translate_hybrid/config/hybrid_config.toml
```

### ç¿»è¯‘æµ‹è¯•æµç¨‹

```bash
# å®¹å™¨å¯åŠ¨åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
# æµ‹è¯•å®Œæˆåè¿›å…¥äº¤äº’å¼ shell

# é…ç½® API
nano /workspace/translate_hybrid/config/hybrid_config.toml
# è®¾ç½®: api_key = "ä½ çš„å¯†é’¥"

# æµ‹è¯•è¿æ¥
cd /workspace/translate_hybrid
cargo run --release -- test-llm --prompt "Hello"

# ç¿»è¯‘å•ä¸ªæ–‡ä»¶
/workspace/scripts/translate_single_file.sh \
    /workspace/translate_chibicc/src/tokenize.c \
    /tmp/tokenize.rs

# æŸ¥çœ‹ç»“æœ
cat /tmp/tokenize.rs

# ç¼–è¯‘éªŒè¯
rustc --crate-type lib /tmp/tokenize.rs
```

## ğŸ“Š chibicc é¡¹ç›®ä¿¡æ¯

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| C æºæ–‡ä»¶ | 9 ä¸ª |
| ä»£ç è¡Œæ•° | ~8,000 è¡Œ |
| å‡½æ•°æ•°é‡ | ~200-300 ä¸ª |
| é¡¹ç›®ç±»å‹ | C ç¼–è¯‘å™¨ |

## ğŸ¯ æµ‹è¯•ç›®æ ‡

### 1. éªŒè¯ AST è§£æ

- âœ… ç”Ÿæˆ compile_commands.json
- âœ… è§£ææ‰€æœ‰ C æºæ–‡ä»¶
- âœ… æ„å»º MIR è¡¨ç¤º

### 2. æµ‹è¯• LLM ç¿»è¯‘

- âœ… å•æ–‡ä»¶ç¿»è¯‘ï¼ˆåˆ©ç”¨ 1049K ä¸Šä¸‹æ–‡ï¼‰
- âœ… åŒ…å«å¤´æ–‡ä»¶ä¸Šä¸‹æ–‡
- âœ… æµå¼å“åº”æ˜¾ç¤ºè¿›åº¦

### 3. ç¼–è¯‘éªŒè¯

- âœ… è‡ªåŠ¨è¿è¡Œ `rustc --check`
- âœ… æ˜¾ç¤ºç¼–è¯‘é”™è¯¯
- âœ… æ”¯æŒè¿­ä»£ä¿®å¤

### 4. ä»£ç è´¨é‡åˆ†æ

- âœ… ç»Ÿè®¡ unsafe å æ¯”
- âœ… ä»£ç è¡Œæ•°å¯¹æ¯”
- âœ… ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

## ğŸ’¡ å…³é”®ç‰¹æ€§

### 1. åˆ©ç”¨å¤§ä¸Šä¸‹æ–‡ï¼ˆ1049Kï¼‰

å•æ¬¡ç¿»è¯‘å¯åŒ…å«ï¼š
- âœ… å®Œæ•´çš„ C æºæ–‡ä»¶ï¼ˆ500-1000 è¡Œï¼‰
- âœ… ç›¸å…³å¤´æ–‡ä»¶å®šä¹‰
- âœ… ç»“æ„ä½“å’Œç±»å‹å®šä¹‰
- âœ… å‡½æ•°ç­¾åä¸Šä¸‹æ–‡

### 2. è‡ªåŠ¨åŒ–æµç¨‹

```
å¯åŠ¨å®¹å™¨ â†’ ç¯å¢ƒæ£€æŸ¥ â†’ ç”Ÿæˆç¼–è¯‘æ•°æ®åº“ â†’ 
AST è§£æ â†’ LLM ç¿»è¯‘ â†’ ç¼–è¯‘éªŒè¯ â†’ 
è´¨é‡åˆ†æ â†’ ç”ŸæˆæŠ¥å‘Š
```

### 3. è¿­ä»£ä¿®å¤

```bash
# ç¿»è¯‘
translate â†’ 

# ç¼–è¯‘æ£€æŸ¥
cargo check â†’ 

# æ”¶é›†é”™è¯¯
errors â†’ 

# LLM ä¿®å¤
fix â†’ 

# é‡å¤ç›´åˆ°é€šè¿‡
```

### 4. è·¨å¹³å°æ”¯æŒ

- âœ… Windowsï¼ˆPowerShellï¼‰
- âœ… Linuxï¼ˆBashï¼‰
- âœ… macOSï¼ˆBashï¼‰

## ğŸ“ˆ é¢„æœŸæ€§èƒ½

### ç¿»è¯‘é€Ÿåº¦

- **å•æ–‡ä»¶**ï¼š30ç§’ - 2åˆ†é’Ÿï¼ˆå–å†³äºå¤§å°ï¼‰
- **å…¨é¡¹ç›®**ï¼š15-30åˆ†é’Ÿï¼ˆ9ä¸ªæ–‡ä»¶ï¼‰

### API æ¶ˆè€—

- **å•æ–‡ä»¶**ï¼š5K-15K tokensï¼ˆè¾“å…¥+è¾“å‡ºï¼‰
- **å…¨é¡¹ç›®**ï¼š200K-300K tokens

### è´¨é‡ç›®æ ‡

- **ç¼–è¯‘é€šè¿‡ç‡**ï¼š>90%
- **unsafe å æ¯”**ï¼š<5%
- **åŠŸèƒ½ç­‰ä»·æ€§**ï¼š100%

## ğŸ”§ æŠ€æœ¯æ ˆ

### Docker é•œåƒ

- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 22.04
- **Rust**ï¼šæœ€æ–° stable
- **Clang**ï¼š14.0
- **LLVM**ï¼š14.0
- **å·¥å…·**ï¼šbear, pkg-config

### ä¸»è¦ä¾èµ–

- **c2rust_agent**ï¼šä¸»é¡¹ç›®ï¼ˆAST è§£æã€MIRï¼‰
- **translate_hybrid**ï¼šLLM ç¿»è¯‘å­é¡¹ç›®
- **reqwest**ï¼šHTTP å®¢æˆ·ç«¯
- **tokio**ï¼šå¼‚æ­¥è¿è¡Œæ—¶
- **console**ï¼šUTF-8 è¾“å‡º

## ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯åš

1. âœ… å¯åŠ¨ Docker å®¹å™¨
2. âœ… é…ç½® API Key
3. âœ… æµ‹è¯•å•æ–‡ä»¶ç¿»è¯‘
4. âœ… éªŒè¯ç¼–è¯‘é€šè¿‡

### åç»­å·¥ä½œ

1. ğŸš§ ç¿»è¯‘å…¨éƒ¨ 9 ä¸ª C æ–‡ä»¶
2. ğŸš§ åˆ›å»ºå®Œæ•´çš„ Cargo é¡¹ç›®
3. ğŸš§ ä¼˜åŒ– unsafe ä»£ç 
4. ğŸš§ è¿è¡ŒåŸæœ‰æµ‹è¯•ç”¨ä¾‹
5. ğŸš§ æ€§èƒ½å¯¹æ¯”æµ‹è¯•

### ä¼˜åŒ–æ–¹å‘

1. ğŸš§ å®ç°æ‰¹é‡ç¿»è¯‘è„šæœ¬
2. ğŸš§ æ·»åŠ å¹¶è¡Œå¤„ç†
3. ğŸš§ ç¼“å­˜ç¿»è¯‘ç»“æœ
4. ğŸš§ è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•
5. ğŸš§ CI/CD é›†æˆ

## ğŸ‰ æˆæœæ€»ç»“

### å·²å®Œæˆ

- âœ… å®Œæ•´çš„ Docker æµ‹è¯•ç¯å¢ƒ
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- âœ… å•æ–‡ä»¶ç¿»è¯‘åŠŸèƒ½
- âœ… ç¼–è¯‘éªŒè¯æœºåˆ¶
- âœ… è´¨é‡åˆ†æå·¥å…·
- âœ… è¯¦ç»†æ–‡æ¡£

### æ–‡ä»¶æ¸…å•

```
C2RustAgent/
â”œâ”€â”€ Dockerfile.translate           # Docker é•œåƒ
â”œâ”€â”€ DOCKER_GUIDE.md               # å®Œæ•´æŒ‡å—
â”œâ”€â”€ DOCKER_QUICKREF.md            # å¿«é€Ÿå‚è€ƒ
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ docker_run.ps1            # Windows å¯åŠ¨
â”‚   â”œâ”€â”€ docker_run.sh             # Linux/Mac å¯åŠ¨
â”‚   â”œâ”€â”€ test_translation.sh       # è‡ªåŠ¨æµ‹è¯•
â”‚   â””â”€â”€ translate_single_file.sh  # å•æ–‡ä»¶ç¿»è¯‘
â””â”€â”€ translate_hybrid/             # LLM ç¿»è¯‘å­é¡¹ç›®
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ llm_client.rs         # å¢å¼º LLM å®¢æˆ·ç«¯
    â”‚   â”œâ”€â”€ utils.rs              # å·¥å…·å‡½æ•°
    â”‚   â””â”€â”€ ...
    â””â”€â”€ config/
        â”œâ”€â”€ hybrid_config.toml.example
        â””â”€â”€ prompts/              # Prompt æ¨¡æ¿
```

### æ ¸å¿ƒä¼˜åŠ¿

1. **å¤§ä¸Šä¸‹æ–‡æ”¯æŒ**ï¼š1049K tokensï¼Œä¸€æ¬¡æ€§ç¿»è¯‘å¤§æ–‡ä»¶
2. **è‡ªåŠ¨åŒ–æµç¨‹**ï¼šä¸€é”®å¯åŠ¨ï¼Œè‡ªåŠ¨æµ‹è¯•
3. **è´¨é‡ä¿è¯**ï¼šç¼–è¯‘éªŒè¯ + unsafe åˆ†æ
4. **æ˜“äºä½¿ç”¨**ï¼šè¯¦ç»†æ–‡æ¡£ + å¿«é€Ÿå‚è€ƒ
5. **è·¨å¹³å°**ï¼šWindowsã€Linuxã€macOS å‡æ”¯æŒ

## ğŸš€ å¼€å§‹ä½¿ç”¨

ç°åœ¨å°±å¯ä»¥è¿è¡Œï¼š

```powershell
cd C:\Users\baoba\Desktop\C2RustAgent
.\scripts\docker_run.ps1
```

ç„¶ååœ¨å®¹å™¨å†…æŒ‰ç…§æç¤ºæ“ä½œï¼Œä½“éªŒå®Œæ•´çš„ C åˆ° Rust ç¿»è¯‘æµç¨‹ï¼

---

**æç¤º**ï¼šæŸ¥çœ‹ `DOCKER_GUIDE.md` è·å–è¯¦ç»†è¯´æ˜ï¼Œæˆ– `DOCKER_QUICKREF.md` å¿«é€Ÿä¸Šæ‰‹ã€‚
